<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>×¡×¤×™×¨×” ×œ××—×•×¨</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="event.css">
</head>
<body>
    <!-- ×›×¤×ª×•×¨ ×—×–×¨×” -->
    <div class="close-page-btn" onclick="goBack()">âœ•</div>
    
    <!-- ×ª×¤×¨×™×˜ ×”××‘×•×¨×’×¨ -->
    <div class="hamburger-menu" onclick="toggleMenu()">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
    </div>
    
    <!-- ×ª×¤×¨×™×˜ ×¦×“ -->
    <div id="sideMenu" class="side-menu">
        <div class="menu-header">
            <h2>×ª×¤×¨×™×˜</h2>
            <button class="close-btn" onclick="toggleMenu()">âœ•</button>
        </div>
        <div class="menu-items">
            <a href="index.html">ğŸ  ×“×£ ×”×‘×™×ª</a>
            <a href="shopping.html">ğŸ›’ ×¨×©×™××ª ×§× ×™×•×ª</a>
            <a href="apartment.html">ğŸ¢ ×“×™×¨×”</a>
            <a href="calendar.html">ğŸ“… ×œ×•×— ×©× ×”</a>
        </div>
    </div>
    
    <!-- ×¨×§×¢ ×›×”×” -->
    <div id="menuOverlay" class="menu-overlay" onclick="toggleMenu()"></div>
    
    <div class="container event-page-container">
        <h1>â° ×¡×¤×™×¨×” ×œ××—×•×¨</h1>
        <div id="eventSubtitle" class="event-subtitle"></div>
        
        <div class="countdown-container">
            <label style="display:block;text-align:right;margin-bottom:10px;color:#666;">×ª××¨×™×š ×”××™×¨×•×¢:</label>
            <input type="date" id="eventDate" class="countdown-date-input" onchange="saveEventDate()" />
            
            <div id="countdownDisplay" class="countdown-display" style="display:none;">
                <div class="countdown-title">â³ × ×•×ª×¨×• ×¢×“ ×”××™×¨×•×¢</div>
                <div class="countdown-boxes">
                    <div class="countdown-box">
                        <span class="countdown-number" id="countDays">0</span>
                        <span class="countdown-label">×™××™×</span>
                    </div>
                    <div class="countdown-box">
                        <span class="countdown-number" id="countHours">0</span>
                        <span class="countdown-label">×©×¢×•×ª</span>
                    </div>
                    <div class="countdown-box">
                        <span class="countdown-number" id="countMinutes">0</span>
                        <span class="countdown-label">×“×§×•×ª</span>
                    </div>
                    <div class="countdown-box">
                        <span class="countdown-number" id="countSeconds">0</span>
                        <span class="countdown-label">×©× ×™×•×ª</span>
                    </div>
                </div>
            </div>
            
            <div id="eventPassed" class="countdown-passed" style="display:none;">
                ğŸ‰ ×”××™×¨×•×¢ ×›×‘×¨ ×”×ª×§×™×™×!
            </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="firebase.js"></script>
    <script src="menu.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('id');
        
        if (!eventId) {
            window.location.href = 'index.html';
        }
        
        let countdownInterval;
        
        // ×˜×¢×™× ×ª ×¤×¨×˜×™ ×”××™×¨×•×¢
        db.collection('userEvents').doc(eventId).onSnapshot(doc => {
            if (doc.exists) {
                const event = doc.data();
                document.getElementById('eventSubtitle').textContent = event.name;
                
                if (event.eventDate) {
                    document.getElementById('eventDate').value = event.eventDate;
                    startCountdown(event.eventDate);
                }
            }
        });
        
        function saveEventDate() {
            const date = document.getElementById('eventDate').value;
            if (date) {
                db.collection('userEvents').doc(eventId).update({
                    eventDate: date
                });
            }
        }
        
        function startCountdown(dateStr) {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            const targetDate = new Date(dateStr + 'T00:00:00');
            
            function updateCountdown() {
                const now = new Date();
                const diff = targetDate - now;
                
                if (diff <= 0) {
                    document.getElementById('countdownDisplay').style.display = 'none';
                    document.getElementById('eventPassed').style.display = 'block';
                    clearInterval(countdownInterval);
                    return;
                }
                
                document.getElementById('countdownDisplay').style.display = 'block';
                document.getElementById('eventPassed').style.display = 'none';
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('countDays').textContent = days;
                document.getElementById('countHours').textContent = hours;
                document.getElementById('countMinutes').textContent = minutes;
                document.getElementById('countSeconds').textContent = seconds;
            }
            
            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
        }
        
        function goBack() {
            window.location.href = `event.html?id=${eventId}`;
        }
    </script>
</body>
</html>
