<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>×¨×¢×™×•× ×•×ª</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="event.css">
</head>
<body>
    <!-- ×›×¤×ª×•×¨ ×—×–×¨×” -->
    <div class="close-page-btn" onclick="goBack()">âœ•</div>
    
    <!-- ×ª×¤×¨×™×˜ ×”××‘×•×¨×’×¨ -->
    <div class="hamburger-menu" onclick="toggleMenu()">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
    </div>
    
    <!-- ×ª×¤×¨×™×˜ ×¦×“ -->
    <div id="sideMenu" class="side-menu">
        <div class="menu-header">
            <h2>×ª×¤×¨×™×˜</h2>
            <button class="close-btn" onclick="toggleMenu()">âœ•</button>
        </div>
        <div class="menu-items">
            <a href="index.html">ğŸ  ×“×£ ×”×‘×™×ª</a>
            <a href="shopping.html">ğŸ›’ ×¨×©×™××ª ×§× ×™×•×ª</a>
            <a href="apartment.html">ğŸ¢ ×“×™×¨×”</a>
            <a href="calendar.html">ğŸ“… ×œ×•×— ×©× ×”</a>
        </div>
    </div>
    
    <!-- ×¨×§×¢ ×›×”×” -->
    <div id="menuOverlay" class="menu-overlay" onclick="toggleMenu()"></div>
    
    <div class="container event-page-container">
        <h1>ğŸ’¡ ×¨×¢×™×•× ×•×ª</h1>
        <div id="eventSubtitle" class="event-subtitle"></div>
        
        <div class="add-form">
            <div class="add-form-row">
                <input type="text" id="ideaText" placeholder="×¨×¢×™×•×Ÿ ×œ××™×¨×•×¢..." style="flex:1;" />
                <button class="btn" onclick="addIdea()">â•</button>
            </div>
        </div>
        
        <ul id="ideasList" class="event-list"></ul>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="firebase.js"></script>
    <script src="menu.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('id');
        
        if (!eventId) {
            window.location.href = 'index.html';
        }
        
        let ideas = [];
        
        // ×˜×¢×™× ×ª ×©× ×”××™×¨×•×¢
        db.collection('userEvents').doc(eventId).get().then(doc => {
            if (doc.exists) {
                document.getElementById('eventSubtitle').textContent = doc.data().name;
            }
        });
        
        // ×”××–× ×” ×œ×¨×¢×™×•× ×•×ª
        db.collection('eventIdeas')
            .where('eventId', '==', eventId)
            .onSnapshot(snapshot => {
                ideas = [];
                snapshot.forEach(doc => {
                    ideas.push({ id: doc.id, ...doc.data() });
                });
                renderIdeas();
            });
        
        function renderIdeas() {
            const list = document.getElementById('ideasList');
            
            if (ideas.length === 0) {
                list.innerHTML = '<div class="empty-message">××™×Ÿ ×¨×¢×™×•× ×•×ª ×¢×“×™×™×Ÿ. ×”×ª×—×™×œ×• ×œ×¨×©×•×! âœ¨</div>';
                return;
            }
            
            list.innerHTML = ideas.map(idea => `
                <li class="idea-item ${idea.completed ? 'completed' : ''}">
                    <input type="checkbox" class="idea-checkbox" ${idea.completed ? 'checked' : ''} onchange="toggleIdea('${idea.id}', this.checked)" />
                    <div class="item-info">
                        <div class="item-name">${idea.text}</div>
                    </div>
                    <button class="delete-btn" onclick="deleteIdea('${idea.id}')">ğŸ—‘ï¸</button>
                </li>
            `).join('');
        }
        
        function addIdea() {
            const text = document.getElementById('ideaText').value.trim();
            
            if (!text) {
                alert('× × ×œ×¨×©×•× ×¨×¢×™×•×Ÿ');
                return;
            }
            
            db.collection('eventIdeas').add({
                eventId: eventId,
                text: text,
                completed: false,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('ideaText').value = '';
            });
        }
        
        function toggleIdea(id, completed) {
            db.collection('eventIdeas').doc(id).update({ completed: completed });
        }
        
        function deleteIdea(id) {
            db.collection('eventIdeas').doc(id).delete();
        }
        
        function goBack() {
            window.location.href = `event.html?id=${eventId}`;
        }
        
        // ×”×•×¡×¤×” ×¢× Enter
        document.getElementById('ideaText').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addIdea();
        });
    </script>
</body>
</html>
